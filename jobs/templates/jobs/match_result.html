{% extends "Layout.html" %}

{% block content %}
<section class="features">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="section-title">
            <h2>匹配结果</h2>
            <p class="text-muted">{{ job.name }} - {{ job.company }}</p>
        </div>
        <a href="{% url 'jobs:job_list' company=job.company %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>返回职位列表
        </a>
    </div>

    <!-- 职位信息卡片 -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>职位信息</h5>
                    <p><strong>职位名称：</strong>{{ job.name }}</p>
                    <p><strong>公司：</strong>{{ job.company }}</p>
                    <p><strong>工作地点：</strong>{{ job.city }}</p>
                    <p><strong>薪资：</strong>{{ job.salary }}</p>
                </div>
                <div class="col-md-6">
                    <h5>要求信息</h5>
                    <p><strong>学历要求：</strong>{{ job.education }}</p>
                    <p><strong>工作年限：</strong>{{ job.work_experience }}</p>
                    <p><strong>语言要求：</strong>{{ job.language }}</p>
                    <p><strong>创建时间：</strong>{{ job.created_at|date:"Y-m-d H:i" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 匹配结果列表 -->
    {% if page_obj %}
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-people me-2"></i>匹配候选人 ({{ page_obj.paginator.count }}人)
            </h5>
        </div>
        <div class="card-body" id="match-result-body">
            {% include "jobs/match_result_table.html" %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info text-center">
        <i class="bi bi-info-circle me-2"></i>
        暂无匹配结果，请稍后再试或检查简历库是否有合适的候选人
    </div>
    {% endif %}

    <!-- {% include "components/Pager.html" %} -->

    <!-- 重新匹配按钮 -->
    <div class="text-center mt-4">
        <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#startMatchingModal"
            data-job-id="{{ job.id }}"
            data-job-name="{{ job.name }}"
            data-job-company="{{ job.company }}"
            data-job-city="{{ job.city }}"
        >
            <i class="bi bi-arrow-clockwise me-1"></i>重新匹配
        </button>

    </div>
</section>

{% include 'jobs/start_matching_confirm.html' %}


{% if messages %}
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1050;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const container = document.getElementById("match-result-body");

  document.addEventListener("click", function (e) {
    if (e.target.closest(".page-ajax")) {
      e.preventDefault();
      const url = e.target.closest("a").getAttribute("href");

      fetch(url, {
        headers: {
          "X-Requested-With": "XMLHttpRequest"
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("请求失败");
        return response.text();
      })
      .then(html => {
        container.innerHTML = html;
      })
      .catch(error => {
        alert("分页加载失败");
        console.error(error);
      });
    }
  });
});
</script>


{% endblock %}

