{% extends "Layout.html" %}
{% load static %}

{% block content %}
<section class="features">
  <div class="section-title">
    <h2>é¢è¯•åˆ—è¡¨</h2>
  </div>

  <!-- ç­›é€‰è¡¨å• -->
  <form method="get" id="filter-form" class="feature-card">
    <!-- å…³é”®è¯æœç´¢ -->
    <div class="input-group input-group-sm mb-3">
      <input
        type="text"
        name="keyword"
        class="form-control"
        placeholder="æœç´¢é¢è¯•å®˜ã€åœ°ç‚¹ã€åé¦ˆ..."
        value="{{ filter_keyword }}"
      >
      <button class="btn btn-primary" type="submit">æœç´¢</button>
    </div>

    <!-- é‡ç½®æŒ‰é’® -->
    <button type="button" id="reset-btn" class="btn btn-outline-secondary btn-sm mb-3">
      ğŸ”„ é‡ç½®
    </button>

    <!-- é¢è¯•é˜¶æ®µç­›é€‰ -->
    <div class="mb-3">
      <label class="form-label">é¢è¯•é˜¶æ®µ</label>
      <select name="stage" class="form-select form-select-sm">
        <option value="">å…¨éƒ¨</option>
        {% for value, label in stage_choices %}
          <option value="{{ value }}" {% if value == selected_stage %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- é¢è¯•çŠ¶æ€ç­›é€‰ -->
    <div class="mb-3">
      <label class="form-label">çŠ¶æ€</label>
      <select name="status" class="form-select form-select-sm">
        <option value="">å…¨éƒ¨</option>
        {% for value, label in status_choices %}
          <option value="{{ value }}" {% if value == selected_status %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- é¢è¯•ç»“æœç­›é€‰ -->
    <div class="mb-3">
      <label class="form-label">ç»“æœ</label>
      <select name="result" class="form-select form-select-sm">
        <option value="">å…¨éƒ¨</option>
        {% for value, label in result_choices %}
          <option value="{{ value }}" {% if value == selected_result %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>
  </form>
</section>

<!-- é¢è¯•åˆ—è¡¨è¡¨æ ¼ -->
<section class="stats">
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>å€™é€‰äºº</th>
          <th>å²—ä½</th>
          <th>é˜¶æ®µ</th>
          <th>çŠ¶æ€</th>
          <th>é¢è¯•æ—¶é—´</th>
          <th>é¢è¯•å®˜</th>
          <th>ç»“æœ</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        {% for interview in interviews %}
          <tr>
            <td>{{ interview.resume.name }}</td>
            <td>{{ interview.job.name }}</td>
            <td>{{ interview.get_stage_display }}</td>
            <td>{{ interview.get_status_display }}</td>
            <td>{{ interview.interview_date|date:"Y-m-d H:i" }}</td>
            <td>{{ interview.interviewer|default:"-" }}</td>
            <td>
              <span class="badge bg-{% if interview.result == 'é€šè¿‡' %}success{% else %}warning{% endif %}">
                {{ interview.get_result_display|default:"å¾…å®š" }}
              </span>
            </td>
            <td>
              <a href="{% url 'interview_detail' interview.id %}" class="btn btn-sm btn-info">è¯¦æƒ…</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="8" class="text-center">æš‚æ— é¢è¯•è®°å½•</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- åˆ†é¡µ -->
  {% include "includes/pagination.html" %}
</section>
{% endblock %}

{% block extra_js %}
<!-- ç­›é€‰å’Œåˆ†é¡µçš„JavaScript -->
<script src="{% static 'interviews/filter.js' %}"></script>

<script>
// é‡ç½®æŒ‰é’®åŠŸèƒ½
document.getElementById("reset-btn").addEventListener("click", function() {
  const form = document.getElementById("filter-form");
  form.reset();
  window.location.search = ""; // æ¸…ç©ºURLå‚æ•°
});

// AJAXåˆ†é¡µï¼ˆå¦‚æœéœ€è¦ï¼‰
$(document).ready(function() {
  // ç±»ä¼¼Resumeé¡µé¢çš„åˆ†é¡µé€»è¾‘
});
</script>
{% endblock %}