{% extends "Layout.html" %}
{% load static %}
{% block content %}

<!-- <section class="hero">
  <h1>简历列表</h1>
  <p>这里展示所有简历，您可以使用筛选器快速查找合适人选。</p>
</section> -->

<section class="features">
    <div class="section-title">
        <h2>简历列表</h2>
    </div>

    <form method="get" id="filter-form" class="feature-card">

        <!-- 搜索框 -->
        <div class="mb-3 text-start">
            <input type="text" name="keyword" class="form-control form-control-sm" placeholder="输入技能、经历、项目等关键词"
                value="{{ filter_keyword }}">
        </div>

        <!-- 城市 -->
        <div class="mb-3 text-start">
            <label class="form-label">城市</label>
            <div class="btn-group" role="group">
                {% for c in city_choices %}
                <button type="button"
                    class="btn {% if c == selected_city %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm city-btn"
                    data-value="{{ c }}">{{ c }}</button>
                {% endfor %}
            </div>
            <input type="hidden" name="city" id="city-input" value="{{ selected_city }}">
        </div>

        <!-- 教育 -->
        <div class="mb-3 text-start">
            <label class="form-label">教育</label>
            <div class="btn-group" role="group">
                {% for edu in education_choices %}
                <button type="button"
                    class="btn {% if edu == selected_education %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm edu-btn"
                    data-value="{{ edu }}">{{ edu }}</button>
                {% endfor %}
            </div>
            <input type="hidden" name="education" id="education-input" value="{{ selected_education }}">
        </div>

        <!-- 年限 -->
        <div class="mb-3 text-start">
            <label class="form-label">年限</label>
            <div class="btn-group" role="group">
                {% for wy in working_years_choices %}
                <button type="button"
                    class="btn {% if wy == selected_working_y %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm workyears-btn"
                    data-value="{{ wy }}">{{ wy }}</button>
                {% endfor %}
            </div>
            <input type="hidden" name="work_years" id="workyears-input" value="{{ selected_working_y }}">
        </div>
    </form>
</section>

<section class="features my-4">
    <div class="section-title">
        <h2>简历上传</h2>
    </div>

    <!-- 上传 Excel -->
    <form method="post" action="{% url 'resume_upload' %}" enctype="multipart/form-data" class="mb-3 upload-form">
        {% csrf_token %}
        <label class="form-label">上传 Excel 文件</label>
        <input type="file" name="file" accept=".csv,.xls,.xlsx" required class="form-control form-control-sm mb-2">
        <button type="submit" class="btn btn-primary btn-sm">上传 CSV/Excel</button>
    </form>

    <!-- 上传 HTML -->
    <form method="post" action="{% url 'resume_upload' %}" enctype="multipart/form-data" class="mb-3 upload-form">
        {% csrf_token %}
        <label class="form-label">上传 HTML 文件</label>
        <input type="file" name="file" accept=".html,.htm" required class="form-control form-control-sm mb-2">
        <button type="submit" class="btn btn-primary btn-sm">上传 HTML</button>
    </form>

    <!-- 上传 PDF -->
    <form method="post" action="{% url 'resume_upload' %}" enctype="multipart/form-data" class="mb-3 upload-form">
        {% csrf_token %}
        <label class="form-label">上传 PDF 文件</label>
        <input type="file" name="file" accept=".pdf" required class="form-control form-control-sm mb-2">
        <button type="submit" class="btn btn-primary btn-sm">上传 PDF</button>
    </form>
</section>



<section class="stats">
    <table class="table table-striped">
        <thead class="pretty-thead-row">
            <tr>
                <th>姓名</th>
                <th>个人信息</th>
                <th>教育</th>
                <th>标签</th>
                <th>当前状态</th>
            </tr>
        </thead>
        <tbody>
            {% for resume in resumes %}
            <tr>
                <td>{{ resume.name }}</td>
                <td>{{ resume.personal_info|default:"-" }}</td>
                <td>{{ resume.education|join:", " }}</td>
                <td>{{ resume.tags|join:", " }}</td>
                <td>{{ resume.current_status }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center">没有找到匹配的简历</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<div class="d-flex justify-content-center mt-4">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-secondary me-2">上一页</a>
    {% endif %}
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="btn btn-secondary">下一页</a>
    {% endif %}
</div>

{% endblock %}


{% block extra_js %}
{% include "components/Toast_js.html" %}
<script src="{% static 'resumes/filter.js' %}"></script>
<script src="{% static 'resumes/upload.js' %}"></script>
{% endblock %}